# CSA_Lab3
Лабораторная работа #3 по дисциплине "Архитектура компьютера"\
Выполнил: Щербинин Эдуард Павлович, P3214

Вариант из таблицы:\
`asm | stack | neum | mc -> hw | instr | struct | stream | port | cstr | prob2 | cache`\
Выполнена в базовом варианте:\
`asm | stack | neum | mc | tick | struct | stream | port | cstr | prob2 | -`

## Язык программирования
#### Синтаксис
```ebnf
<program> ::= <line>+

<line> ::= <label> <comment>? '\n'
       | <instr> <comment>? '\n'
       | <comment>? '\n'

<label> ::= <label_name> ':'

<label_name> ::= [a-zA-Z_]+

<instr> ::= <op0>
        | <op1> ' ' <label_name>
        | <op1> ' ' [1-9] [0-9]*
        | <op1> ' 0x' [1-9a-f] [0-9a-f]*
        | word ' ' ".*"
        
<op0> ::= "add"
      | "halt"

<op1> ::= "push"
      | "pop"
      
<comment> ::= ' '* ';' [^\n]*

```

#### Семантика
Код выполняется последовательно, одна инструкция за другой.

Метки определяются на отдельной строке исходного кода.
Чувствительны к регистру. Переопределение недопустимо.\
Метки могут быть использованы как аргумент (в т.ч. до определения)\
Адресация начинается с `0x1`. Адрес `0x0` интерпретируется как `NULL`.

Выполнение программы начинается с метки `_start`.

Доступны команды транслятора:
* `WORD <arg>` - объявить переменную в памяти
* `DB <arg>` - WORD alias
* `RESW <amount>` - зарезервировать в памяти буфер на `amount` машинных слов. Инициализируется нулями

Для набора инструкций см. [систему команд](#система-команд)

Пример использования:
```asm
decimal: ; Определение метки
    word 42 ; Инициализирует ячейку десячитным числом
    db 42 ; Эквивалент
hexadecimal:
    word 0xA ; Инициализирует ячейку шестнадцатеричным числом
message:
    word "Hello, world!", 0xA, 0 ; Инициализирует каждый символ строки в собственную ячейку по порядку
buffer:
    resw 256 ; Выделит в памяти 256 слов
    resw 0x100 ; Эквивалент

_start: ; начало выполнения программы
    push decimal ; Как аргумент команде передастся адрес метки decimal
```

## Система команд

Набор инструкций (обозначения: `<аргумент>`, `{..., TOS-1, TOS}`, `[опционально]`):
* `NOP` – нет операции
* `PUSH <addr/lit>` - положить на вершину стека значение по адресу метки / прямое значение
* `POP [<addr>] {value}` - снять значение с вершины стека и [положить по адресу метки]
* `ADD {e1, e2}` – положить на стек результат операции сложения e1 + e2
* `SUB {e1, e2}` – положить на стек результат операции вычитания e1 – e2
* `MUL {e1, e2}` – положить на стек результат операции умножения e1 * e2
* `DIV {e1, e2}` – положить на стек результат операции _целочисленного_ деления e1 / e2
* `MOD { e1, e2 }` – положить на стек результат операции взятия остатка e1 % e2.
* `INC { element }` – увеличить значение вершины стека на 1
* `DEC { element }` – уменьшить значение вершины стека на 1
* `DUP { element }` – дублировать элемент на стеке

Если команда задействовала `{элемент стека}`, он будет снят со стека.
